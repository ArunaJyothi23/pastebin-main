(()=>{var e={};e.id=348,e.ids=[348],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4770:e=>{"use strict";e.exports=require("crypto")},8678:e=>{"use strict";e.exports=import("pg")},1202:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>p,routeModule:()=>c,serverHooks:()=>w,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a=r(2412),n=r(4293),i=r(4147),o=r(7666),u=e([o]);o=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/pastes/route",pathname:"/api/pastes",filename:"route",bundlePath:"app/api/pastes/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\pastebin-main\\backend\\app\\api\\pastes\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:w}=c;function p(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}s()}catch(e){s(e)}})},5303:()=>{},7666:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{POST:()=>u});var a=r(7856),n=r(8677),i=r(4770),o=e([n]);async function u(e){try{let t=await e.json(),r=t.content;if(!r||!r.trim())return a.NextResponse.json({detail:"Content is required"},{status:400});let s=function(e=8){return(0,i.randomBytes)(e).toString("base64url").slice(0,e)}(8),o=function(e){if("1"===process.env.TEST_MODE){let t=e.headers.get("x-test-now-ms");if(t){let e=Number(t);if(!Number.isNaN(e))return new Date(e)}}return new Date}(e),u=t.ttl_seconds??t.expiresInSeconds??null,p=t.max_views??t.maxViews??null,c=null;u&&u>0&&(c=new Date(o.getTime()+1e3*u));let d=await n.d.connect();try{await d.query("BEGIN"),await d.query("DELETE FROM pastes WHERE expires_at IS NOT NULL AND expires_at < $1",[o]),await d.query("DELETE FROM pastes WHERE max_views IS NOT NULL AND view_count >= max_views"),await d.query(`INSERT INTO pastes (id, content, created_at, expires_at, max_views, view_count)
         VALUES ($1, $2, $3, $4, $5, 0)`,[s,r,o,c,p]),await d.query("COMMIT")}catch(e){throw await d.query("ROLLBACK"),e}finally{d.release()}return a.NextResponse.json({id:s,url:`/p/${s}`},{status:201})}catch(e){return console.error("Error creating paste",e),a.NextResponse.json({detail:"Failed to create paste"},{status:500})}}n=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},8677:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{d:()=>i});var a=r(8678),n=e([a]);if(a=(n.then?(await n)():n)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL env var is required for Postgres connection");let i=new a.Pool({connectionString:process.env.DATABASE_URL,max:5,idleTimeoutMillis:3e4});s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,814],()=>r(1202));module.exports=s})();