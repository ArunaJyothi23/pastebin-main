(()=>{var e={};e.id=348,e.ids=[348],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4770:e=>{"use strict";e.exports=require("crypto")},8678:e=>{"use strict";e.exports=import("pg")},1202:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>c,routeModule:()=>p,serverHooks:()=>w,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var n=r(2412),a=r(4293),i=r(4147),o=r(7666),u=e([o]);o=(u.then?(await u)():u)[0];let p=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/pastes/route",pathname:"/api/pastes",filename:"route",bundlePath:"app/api/pastes/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\pastebin-main\\backend\\app\\api\\pastes\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:w}=p;function c(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}s()}catch(e){s(e)}})},5303:()=>{},7666:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{OPTIONS:()=>c,POST:()=>u});var n=r(7856),a=r(8677),i=r(4770),o=e([a]);async function u(e){try{let t=await e.json(),r=t.content;if(!r||!r.trim())return n.NextResponse.json({detail:"Content is required"},{status:400});let s=function(e=8){return(0,i.randomBytes)(e).toString("base64url").slice(0,e)}(8),o=function(e){if("1"===process.env.TEST_MODE){let t=e.headers.get("x-test-now-ms");if(t){let e=Number(t);if(!Number.isNaN(e))return new Date(e)}}return new Date}(e),u=t.ttl_seconds??t.expiresInSeconds??null,c=t.max_views??t.maxViews??null,p=null;u&&u>0&&(p=new Date(o.getTime()+1e3*u));let l=await a.d.connect();try{await l.query("BEGIN"),await l.query("DELETE FROM pastes WHERE expires_at IS NOT NULL AND expires_at < $1",[o]),await l.query("DELETE FROM pastes WHERE max_views IS NOT NULL AND view_count >= max_views"),await l.query(`INSERT INTO pastes (id, content, created_at, expires_at, max_views, view_count)
         VALUES ($1, $2, $3, $4, $5, 0)`,[s,r,o,p,c]),await l.query("COMMIT")}catch(e){throw await l.query("ROLLBACK"),e}finally{l.release()}return n.NextResponse.json({id:s,url:`/p/${s}`},{status:201})}catch(e){return console.error("Error creating paste",e),n.NextResponse.json({detail:"Failed to create paste"},{status:500})}}async function c(){return new n.NextResponse(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Date, X-Api-Version"}})}a=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},8677:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{d:()=>i});var n=r(8678),a=e([n]);if(n=(a.then?(await a)():a)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL env var is required for Postgres connection");let i=new n.Pool({connectionString:process.env.DATABASE_URL,max:5,idleTimeoutMillis:3e4});s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,814],()=>r(1202));module.exports=s})();