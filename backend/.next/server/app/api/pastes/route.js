(()=>{var e={};e.id=348,e.ids=[348],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4770:e=>{"use strict";e.exports=require("crypto")},8678:e=>{"use strict";e.exports=import("pg")},1202:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{patchFetch:()=>u,routeModule:()=>p,serverHooks:()=>w,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var a=s(2412),n=s(4293),i=s(4147),o=s(7666),c=e([o]);o=(c.then?(await c)():c)[0];let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/pastes/route",pathname:"/api/pastes",filename:"route",bundlePath:"app/api/pastes/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\pastebin-main\\backend\\app\\api\\pastes\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:w}=p;function u(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}r()}catch(e){r(e)}})},5303:()=>{},7666:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{OPTIONS:()=>u,POST:()=>c});var a=s(7856),n=s(8677),i=s(4770),o=e([n]);async function c(e){try{let t=await e.json(),s=t.content;if(!s||!s.trim())return a.NextResponse.json({detail:"Content is required"},{status:400});let r=function(e=8){return(0,i.randomBytes)(e).toString("base64url").slice(0,e)}(8),o=function(e){if("1"===process.env.TEST_MODE){let t=e.headers.get("x-test-now-ms");if(t){let e=Number(t);if(!Number.isNaN(e))return new Date(e)}}return new Date}(e),c=t.ttl_seconds??t.expiresInSeconds??null,u=t.max_views??t.maxViews??null,p=null;c&&c>0&&(p=new Date(o.getTime()+1e3*c));let l=await n.d.connect();try{await l.query("BEGIN"),await l.query("DELETE FROM pastes WHERE expires_at IS NOT NULL AND expires_at < $1",[o]),await l.query("DELETE FROM pastes WHERE max_views IS NOT NULL AND views >= max_views"),await l.query(`INSERT INTO pastes (id, content, created_at, expires_at, max_views, views)
         VALUES ($1, $2, $3, $4, $5, 0)`,[r,s,o,p,u]),await l.query("COMMIT")}catch(e){throw await l.query("ROLLBACK"),e}finally{l.release()}return a.NextResponse.json({id:r,url:`/p/${r}`},{status:201})}catch(e){return console.error("CRITICAL ERROR creating paste:",{message:e.message,stack:e.stack,detail:e}),a.NextResponse.json({detail:`Failed to create paste: ${e.message}`},{status:500})}}async function u(){return new a.NextResponse(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Date, X-Api-Version"}})}n=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},8677:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{d:()=>i});var a=s(8678),n=e([a]);if(a=(n.then?(await n)():n)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL env var is required for Postgres connection");let i=new a.Pool({connectionString:process.env.DATABASE_URL,max:5,idleTimeoutMillis:3e4});r()}catch(e){r(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[267,814],()=>s(1202));module.exports=r})();