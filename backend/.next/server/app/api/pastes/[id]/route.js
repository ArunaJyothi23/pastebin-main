(()=>{var e={};e.id=1,e.ids=[1],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8678:e=>{"use strict";e.exports=import("pg")},7199:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>p,routeModule:()=>c,serverHooks:()=>w,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a=r(2412),i=r(4293),n=r(4147),o=r(3985),u=e([o]);o=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/pastes/[id]/route",pathname:"/api/pastes/[id]",filename:"route",bundlePath:"app/api/pastes/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\pastebin-main\\backend\\app\\api\\pastes\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:w}=c;function p(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}s()}catch(e){s(e)}})},5303:()=>{},3985:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>o});var a=r(7856),i=r(8677),n=e([i]);async function o(e,{params:t}){let{id:r}=await t;try{let t=function(e){if("1"===process.env.TEST_MODE){let t=e.headers.get("x-test-now-ms");if(t){let e=Number(t);if(!Number.isNaN(e))return new Date(e)}}return new Date}(e),s=await i.d.connect();try{await s.query("BEGIN");let{rows:e}=await s.query("SELECT * FROM pastes WHERE id = $1",[r]);if(0===e.length)return await s.query("ROLLBACK"),a.NextResponse.json({detail:"Paste not found"},{status:404});let i=e[0];if(i.expires_at&&new Date(i.expires_at)<t||null!==i.max_views&&i.view_count>=i.max_views)return await s.query("DELETE FROM pastes WHERE id = $1",[r]),await s.query("COMMIT"),a.NextResponse.json({detail:"Paste not found"},{status:404});let{rows:n}=await s.query("UPDATE pastes SET view_count = view_count + 1 WHERE id = $1 RETURNING *",[r]);await s.query("COMMIT");let o=n[0];return a.NextResponse.json({content:o.content,viewCount:o.view_count,expiresAt:o.expires_at,maxViews:o.max_views})}catch(e){throw await s.query("ROLLBACK"),e}finally{s.release()}}catch(e){return console.error("Error fetching paste",e),a.NextResponse.json({detail:"Failed to fetch paste"},{status:500})}}i=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},8677:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{d:()=>n});var a=r(8678),i=e([a]);if(a=(i.then?(await i)():i)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL env var is required for Postgres connection");let n=new a.Pool({connectionString:process.env.DATABASE_URL,max:5,idleTimeoutMillis:3e4});s()}catch(e){s(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,814],()=>r(7199));module.exports=s})();