(()=>{var e={};e.id=494,e.ids=[494],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8678:e=>{"use strict";e.exports=import("pg")},7258:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{patchFetch:()=>p,routeModule:()=>c,serverHooks:()=>l,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>w});var s=r(2412),i=r(4293),n=r(4147),o=r(9616),u=e([o]);o=(u.then?(await u)():u)[0];let c=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/paste/[id]/route",pathname:"/api/paste/[id]",filename:"route",bundlePath:"app/api/paste/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\pastebin-main\\backend\\app\\api\\paste\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:w,serverHooks:l}=c;function p(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:w})}a()}catch(e){a(e)}})},5303:()=>{},9616:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>o});var s=r(7856),i=r(8677),n=e([i]);async function o(e,{params:t}){let{id:r}=await t;try{let e=await i.d.connect();try{await e.query("BEGIN");let{rows:t}=await e.query("SELECT * FROM pastes WHERE id = $1",[r]);if(0===t.length)return await e.query("ROLLBACK"),s.NextResponse.json({detail:"Paste not found"},{status:404});let a=t[0],i=new Date;if(a.expires_at&&new Date(a.expires_at)<i)return await e.query("DELETE FROM pastes WHERE id = $1",[r]),await e.query("COMMIT"),s.NextResponse.json({detail:"Paste has expired"},{status:410});if(null!==a.max_views&&a.view_count>=a.max_views)return await e.query("DELETE FROM pastes WHERE id = $1",[r]),await e.query("COMMIT"),s.NextResponse.json({detail:"Paste has reached maximum views"},{status:410});let{rows:n}=await e.query("UPDATE pastes SET view_count = view_count + 1 WHERE id = $1 RETURNING *",[r]);await e.query("COMMIT");let o=n[0];return s.NextResponse.json({content:o.content,viewCount:o.view_count,expiresAt:o.expires_at,maxViews:o.max_views})}catch(t){throw await e.query("ROLLBACK"),t}finally{e.release()}}catch(e){return console.error("Error fetching paste",e),s.NextResponse.json({detail:"Failed to fetch paste"},{status:500})}}i=(n.then?(await n)():n)[0],a()}catch(e){a(e)}})},8677:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{d:()=>n});var s=r(8678),i=e([s]);if(s=(i.then?(await i)():i)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL env var is required for Postgres connection");let n=new s.Pool({connectionString:process.env.DATABASE_URL,max:5,idleTimeoutMillis:3e4});a()}catch(e){a(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[267,814],()=>r(7258));module.exports=a})();